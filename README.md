# Whisper FastAPI Microservice

–≠—Ç–æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FastAPI –∏ OpenAI Whisper –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª —á–µ—Ä–µ–∑ HTTP POST-–∑–∞–ø—Ä–æ—Å, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –µ–≥–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫-–ª–æ–∫–∞–ª—å–Ω–æ)
- [–ó–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é Docker](#–∑–∞–ø—É—Å–∫-—Å-–ø–æ–º–æ—â—å—é-docker)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞](#–ø—Ä–∏–º–µ—Ä-–∑–∞–ø—Ä–æ—Å–∞)
- [–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∞—É–¥–∏–æ](#–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ-—Ñ–æ—Ä–º–∞—Ç—ã-–∞—É–¥–∏–æ)
- [–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª—è—Ö Whisper](#–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è-–æ-–º–æ–¥–µ–ª—è—Ö-whisper)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è:

- Python 3.9+
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π [FFmpeg](https://ffmpeg.org/download.html) –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∞—É–¥–∏–æ
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π [Docker](https://docs.docker.com/get-docker/) (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository_url>
cd Whisper_Fastapi_Service
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python3 -m venv venv
source venv/bin/activate  # –¥–ª—è Linux/MacOS
# –∏–ª–∏
venv\Scripts\activate  # –¥–ª—è Windows
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r app/requirements.txt
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

### 5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É

```bash
    http://127.0.0.1:8000
```

## –ó–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é Docker

### 1. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ Docker-–æ–±—Ä–∞–∑–∞

```bash
docker build -t my_microservice .
```

### 2. –ó–∞–ø—É—Å–∫ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker run -d -p 80:80 my_microservice
```

### 3. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

```bash
http://localhost:80
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ –∏ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ Whisper

#### `POST /transcribe/`

–≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Whisper –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.

- **URL**: `/transcribe/`
- **–ú–µ—Ç–æ–¥**: `POST`
- **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: `multipart/form-data`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  - `file`: –∞—É–¥–∏–æ—Ñ–∞–π–ª (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
  - `whisper_model`: –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ Whisper –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π). –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏: `tiny`, `base`, `small`, `medium`, `large`, `turbo`.

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
curl -X POST "http://127.0.0.1:8000/transcribe/" \
    -F "file=@/path/to/audiofile.ogg" \
    -F "whisper_model=base"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "transcription": "This is the transcribed text from the audio file."
}
```

## üìù API documentation

- SWAGGER-UI - `/docs/`
- REDOC - `/redoc/`

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∞—É–¥–∏–æ

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤:

- `audio/mpeg` (MP3)
- `audio/wav` (WAV)
- `audio/x-wav` (WAV)
- `audio/flac` (FLAC)
- `audio/ogg` (OGG)

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –∏–º–µ–µ—Ç –æ–¥–∏–Ω –∏–∑ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞.

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª—è—Ö Whisper

–ú–æ–¥–µ–ª–∏ Whisper —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ø–æ —Ä–∞–∑–º–µ—Ä—É, –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º —è–∑—ã–∫–∞–º, —Ç—Ä–µ–±—É–µ–º–æ–π –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ (VRAM) –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:

| Model   | Parameters | English-only model | Multilingual model | Required VRAM | Relative speed |
|---------|------------|--------------------|--------------------|---------------|----------------|
| tiny    | 39 M       | `tiny.en`          | `tiny`             | ~1 GB         | ~10x           |
| base    | 74 M       | `base.en`          | `base`             | ~1 GB         | ~7x            |
| small   | 244 M      | `small.en`         | `small`            | ~2 GB         | ~4x            |
| medium  | 769 M      | `medium.en`        | `medium`           | ~5 GB         | ~2x            |
| large   | 1550 M     | N/A                | `large`            | ~10 GB        | 1x             |
| turbo   | 809 M      | N/A                | `turbo`            | ~6 GB         | ~8x            |

- **Relative speed**: –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–æ–¥–µ–ª–∏. –ú–æ–¥–µ–ª–∏ —Å –±–æ–ª—å—à–µ–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é (`10x`, `7x`) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∞—É–¥–∏–æ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –º–æ–¥–µ–ª–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ `large` (`1x`).
- **Required VRAM**: –¢—Ä–µ–±—É–µ–º—ã–π –æ–±—ä—ë–º –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏. –ë–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ `large`, —Ç—Ä–µ–±—É—é—Ç –¥–æ 10 –ì–ë –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏.

## [–ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞](https://github.com/NewalexOA/Whisper_Fastapi_Service/blob/main/Docs/Fufture_updates.md)
